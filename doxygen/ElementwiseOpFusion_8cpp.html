<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MLIR: lib/Dialect/Linalg/Transforms/ElementwiseOpFusion.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MLIR
   &#160;<span id="projectnumber">14.0.0git</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97aefd0d527b934f1d99a682da8fe6a9.html">lib</a></li><li class="navelem"><a class="el" href="dir_1a25ec519b6c1121408b67cc33ce3f15.html">Dialect</a></li><li class="navelem"><a class="el" href="dir_8edb792440615361a0811a7329611599.html">Linalg</a></li><li class="navelem"><a class="el" href="dir_7e2f808e77498894ca0efbd745da2201.html">Transforms</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">ElementwiseOpFusion.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="lib_2Dialect_2Linalg_2Transforms_2PassDetail_8h_source.html">PassDetail.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="AffineOps_8h_source.html">mlir/Dialect/Affine/IR/AffineOps.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="LinalgOps_8h_source.html">mlir/Dialect/Linalg/IR/LinalgOps.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="LinalgTypes_8h_source.html">mlir/Dialect/Linalg/IR/LinalgTypes.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="Dialect_2Linalg_2Passes_8h_source.html">mlir/Dialect/Linalg/Passes.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="Dialect_2Linalg_2Transforms_2Transforms_8h_source.html">mlir/Dialect/Linalg/Transforms/Transforms.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="Dialect_2Linalg_2Utils_2Utils_8h_source.html">mlir/Dialect/Linalg/Utils/Utils.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="IR_2AffineExpr_8h_source.html">mlir/IR/AffineExpr.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="IR_2AffineMap_8h_source.html">mlir/IR/AffineMap.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="Matchers_8h_source.html">mlir/IR/Matchers.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="PatternMatch_8h_source.html">mlir/IR/PatternMatch.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="Support_2LLVM_8h_source.html">mlir/Support/LLVM.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="GreedyPatternRewriteDriver_8h_source.html">mlir/Transforms/GreedyPatternRewriteDriver.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for ElementwiseOpFusion.cpp:</div>
<div class="dyncontent">
<div class="center"><img src="ElementwiseOpFusion_8cpp__incl.png" border="0" usemap="#lib_2Dialect_2Linalg_2Transforms_2ElementwiseOpFusion_8cpp" alt=""/></div>
<map name="lib_2Dialect_2Linalg_2Transforms_2ElementwiseOpFusion_8cpp" id="lib_2Dialect_2Linalg_2Transforms_2ElementwiseOpFusion_8cpp">
<area shape="rect" id="node2" href="lib_2Dialect_2Linalg_2Transforms_2PassDetail_8h.html" title="PassDetail.h" alt="" coords="223,102,326,129"/>
<area shape="rect" id="node3" href="AffineOps_8h.html" title="mlir/Dialect/Affine\l/IR/AffineOps.h" alt="" coords="421,541,561,583"/>
<area shape="rect" id="node5" href="IR_2AffineMap_8h.html" title="mlir/IR/AffineMap.h" alt="" coords="3323,727,3469,754"/>
<area shape="rect" id="node6" href="IR_2AffineExpr_8h.html" title="mlir/IR/AffineExpr.h" alt="" coords="3643,817,3789,843"/>
<area shape="rect" id="node7" href="Support_2LLVM_8h.html" title="mlir/Support/LLVM.h" alt="" coords="3462,899,3613,925"/>
<area shape="rect" id="node20" href="LinalgOps_8h.html" title="mlir/Dialect/Linalg\l/IR/LinalgOps.h" alt="" coords="2352,363,2493,404"/>
<area shape="rect" id="node21" href="LinalgTypes_8h.html" title="mlir/Dialect/Linalg\l/IR/LinalgTypes.h" alt="" coords="1013,452,1155,493"/>
<area shape="rect" id="node25" href="PatternMatch_8h.html" title="mlir/IR/PatternMatch.h" alt="" coords="3987,727,4154,754"/>
<area shape="rect" id="node43" href="Dialect_2Linalg_2Passes_8h.html" title="mlir/Dialect/Linalg\l/Passes.h" alt="" coords="1139,95,1280,136"/>
<area shape="rect" id="node44" href="Dialect_2Linalg_2Transforms_2Transforms_8h.html" title="mlir/Dialect/Linalg\l/Transforms/Transforms.h" alt="" coords="3004,184,3191,225"/>
<area shape="rect" id="node46" href="Dialect_2Linalg_2Utils_2Utils_8h.html" title="mlir/Dialect/Linalg\l/Utils/Utils.h" alt="" coords="1405,273,1547,315"/>
<area shape="rect" id="node49" href="Matchers_8h.html" title="mlir/IR/Matchers.h" alt="" coords="1563,727,1703,754"/>
<area shape="rect" id="node50" href="GreedyPatternRewriteDriver_8h.html" title="mlir/Transforms/GreedyPattern\lRewriteDriver.h" alt="" coords="4331,95,4552,136"/>
<area shape="rect" id="node10" href="IR_2Dialect_8h.html" title="mlir/IR/Dialect.h" alt="" coords="597,973,723,1000"/>
<area shape="rect" id="node18" href="include_2mlir_2Pass_2Pass_8h.html" title="mlir/Pass/Pass.h" alt="" coords="211,191,338,218"/>
<area shape="rect" id="node4" href="AffineMemoryOpInterfaces_8h.html" title="mlir/Dialect/Affine\l/IR/AffineMemoryOpInterfaces.h" alt="" coords="984,631,1213,672"/>
<area shape="rect" id="node11" href="Ops_8h.html" title="mlir/Dialect/StandardOps\l/IR/Ops.h" alt="" coords="673,631,858,672"/>
<area shape="rect" id="node15" href="LoopLikeInterface_8h.html" title="mlir/Interfaces/LoopLike\lInterface.h" alt="" coords="571,809,749,851"/>
<area shape="rect" id="node8" href="IR_2BuiltinTypes_8h.html" title="mlir/IR/BuiltinTypes.h" alt="" coords="1915,817,2075,843"/>
<area shape="rect" id="node9" href="OpDefinition_8h.html" title="mlir/IR/OpDefinition.h" alt="" coords="1393,899,1556,925"/>
<area shape="rect" id="node12" href="Arithmetic_8h.html" title="mlir/Dialect/Arithmetic\l/IR/Arithmetic.h" alt="" coords="672,720,843,761"/>
<area shape="rect" id="node13" href="SideEffectInterfaces_8h.html" title="mlir/Interfaces/SideEffect\lInterfaces.h" alt="" coords="1064,809,1251,851"/>
<area shape="rect" id="node14" href="InferTypeOpInterface_8h.html" title="mlir/Interfaces/InferType\lOpInterface.h" alt="" coords="2251,720,2432,761"/>
<area shape="rect" id="node23" href="MemRef_8h.html" title="mlir/Dialect/MemRef\l/IR/MemRef.h" alt="" coords="1433,541,1588,583"/>
<area shape="rect" id="node24" href="ReshapeOpsUtils_8h.html" title="mlir/Dialect/Utils\l/ReshapeOpsUtils.h" alt="" coords="3753,631,3901,672"/>
<area shape="rect" id="node26" href="CopyOpInterface_8h.html" title="mlir/Interfaces/CopyOpInterface.h" alt="" coords="1389,638,1632,665"/>
<area shape="rect" id="node27" href="ViewLikeInterface_8h.html" title="mlir/Interfaces/ViewLike\lInterface.h" alt="" coords="2457,720,2637,761"/>
<area shape="rect" id="node31" href="Types_8h.html" title="mlir/IR/Types.h" alt="" coords="1985,549,2103,575"/>
<area shape="rect" id="node34" href="StructuredOpsUtils_8h.html" title="mlir/Dialect/Utils\l/StructuredOpsUtils.h" alt="" coords="3107,631,3267,672"/>
<area shape="rect" id="node35" href="BlockAndValueMapping_8h.html" title="mlir/IR/BlockAndValueMapping.h" alt="" coords="3291,638,3525,665"/>
<area shape="rect" id="node36" href="BuiltinDialect_8h.html" title="mlir/IR/BuiltinDialect.h" alt="" coords="3966,899,4135,925"/>
<area shape="rect" id="node37" href="TypeUtilities_8h.html" title="mlir/IR/TypeUtilities.h" alt="" coords="3288,459,3451,486"/>
<area shape="rect" id="node39" href="TilingInterface_8h.html" title="mlir/Interfaces/TilingInterface.h" alt="" coords="2755,638,2981,665"/>
<area shape="rect" id="node40" href="LinalgInterfaces_8h.html" title="mlir/Dialect/Linalg\l/IR/LinalgInterfaces.h" alt="" coords="2470,541,2629,583"/>
<area shape="rect" id="node22" href="Math_8h.html" title="mlir/Dialect/Math/IR\l/Math.h" alt="" coords="918,720,1069,761"/>
<area shape="rect" id="node29" href="Dialect_2Tensor_2IR_2Tensor_8h.html" title="mlir/Dialect/Tensor\l/IR/Tensor.h" alt="" coords="2048,631,2192,672"/>
<area shape="rect" id="node30" href="ImplicitLocOpBuilder_8h.html" title="mlir/IR/ImplicitLocOpBuilder.h" alt="" coords="1657,638,1871,665"/>
<area shape="rect" id="node28" href="StaticValueUtils_8h.html" title="mlir/Dialect/Utils\l/StaticValueUtils.h" alt="" coords="2911,809,3052,851"/>
<area shape="rect" id="node45" href="VectorToSCF_8h.html" title="mlir/Conversion/VectorTo\lSCF/VectorToSCF.h" alt="" coords="3920,363,4104,404"/>
<area shape="rect" id="node47" href="Dialect_2SCF_2Utils_8h.html" title="mlir/Dialect/SCF/Utils.h" alt="" coords="3729,459,3901,486"/>
<area shape="rect" id="node48" href="VectorTransforms_8h.html" title="mlir/Dialect/Vector\l/VectorTransforms.h" alt="" coords="3585,273,3735,315"/>
</map>
</div>
</div>
<p><a href="ElementwiseOpFusion_8cpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a19679bdb1cb388e2cf93c2dab27ffe52"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ElementwiseOpFusion_8cpp.html#a19679bdb1cb388e2cf93c2dab27ffe52">getIndexingMapOfProducerOperandsInCoordinatesOfFusedOp</a> (<a class="el" href="classmlir_1_1OpOperand.html">OpOperand</a> *producerOpOperand, <a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a> producerResultIndexMap, <a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a> fusedConsumerArgIndexMap)</td></tr>
<tr class="memdesc:a19679bdb1cb388e2cf93c2dab27ffe52"><td class="mdescLeft">&#160;</td><td class="mdescRight">Append to <code>fusedOpIndexingMapAttrs</code> the indexing maps for the operands of the <code>producer</code> to use in the fused operation given the indexing map of the result of the producer in the consumer.  <a href="#a19679bdb1cb388e2cf93c2dab27ffe52">More...</a><br /></td></tr>
<tr class="separator:a19679bdb1cb388e2cf93c2dab27ffe52"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad5db310021e942e1aebc58774be61a65"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ElementwiseOpFusion_8cpp.html#ad5db310021e942e1aebc58774be61a65">areElementwiseOpsFusable</a> (GenericOp producer, GenericOp consumer, <a class="el" href="classmlir_1_1OpOperand.html">OpOperand</a> *consumerOpOperand)</td></tr>
<tr class="memdesc:ad5db310021e942e1aebc58774be61a65"><td class="mdescLeft">&#160;</td><td class="mdescRight">Conditions for elementwise fusion of generic operations.  <a href="#ad5db310021e942e1aebc58774be61a65">More...</a><br /></td></tr>
<tr class="separator:ad5db310021e942e1aebc58774be61a65"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a42aab670a146bbd3928a9c54a9d18c3e"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classvoid.html">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ElementwiseOpFusion_8cpp.html#a42aab670a146bbd3928a9c54a9d18c3e">generateFusedElementwiseOpRegion</a> (<a class="el" href="classmlir_1_1PatternRewriter.html">PatternRewriter</a> &amp;rewriter, GenericOp fusedOp, <a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a> consumerToProducerLoopsMap, <a class="el" href="classmlir_1_1OpOperand.html">OpOperand</a> *consumerOpOperand, <a class="el" href="classunsigned.html">unsigned</a> nloops)</td></tr>
<tr class="memdesc:a42aab670a146bbd3928a9c54a9d18c3e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generate the region of the fused tensor operation.  <a href="#a42aab670a146bbd3928a9c54a9d18c3e">More...</a><br /></td></tr>
<tr class="separator:a42aab670a146bbd3928a9c54a9d18c3e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ad4a9eeb98d28aab625b54dbd390fea"><td class="memItemLeft" align="right" valign="top">static Optional&lt; SmallVector&lt; <a class="el" href="classmlir_1_1Value.html">Value</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ElementwiseOpFusion_8cpp.html#a0ad4a9eeb98d28aab625b54dbd390fea">fuseElementwiseOpsImpl</a> (GenericOp producer, <a class="el" href="classmlir_1_1OpOperand.html">OpOperand</a> *consumerOpOperand, const <a class="el" href="namespacemlir_1_1linalg.html#a7f0c7d5683991009cfddd7748b7f8d4d">ControlElementwiseOpsFusionFn</a> &amp;controlFn, <a class="el" href="classmlir_1_1PatternRewriter.html">PatternRewriter</a> &amp;rewriter)</td></tr>
<tr class="separator:a0ad4a9eeb98d28aab625b54dbd390fea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af364bc35560a153d63a9825064858f4b"><td class="memTemplParams" colspan="2">template&lt;typename TensorReshapeOp &gt; </td></tr>
<tr class="memitem:af364bc35560a153d63a9825064858f4b"><td class="memTemplItemLeft" align="right" valign="top">static <a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a>&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="ElementwiseOpFusion_8cpp.html#af364bc35560a153d63a9825064858f4b">linearizeCollapsedDims</a> (<a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a> sourceMap, TensorReshapeOp reshapeOp)</td></tr>
<tr class="memdesc:af364bc35560a153d63a9825064858f4b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Linearize the expressions in <code>sourceMap</code> based on the <code>reassociationMaps</code> provided, given the shape of the source tensor that corresponds to the <code>sourceMap</code>.  <a href="#af364bc35560a153d63a9825064858f4b">More...</a><br /></td></tr>
<tr class="separator:af364bc35560a153d63a9825064858f4b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ce95957ed38439fd53d3d27e52d94bc"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ElementwiseOpFusion_8cpp.html#a6ce95957ed38439fd53d3d27e52d94bc">isTensorReshapeOpFoldableByLinearization</a> (TensorExpandShapeOp expandOp, <a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a> useIndexMap, bool asProducer)</td></tr>
<tr class="separator:a6ce95957ed38439fd53d3d27e52d94bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e19cdff9b62760e6c10ba766a055eaf"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ElementwiseOpFusion_8cpp.html#a3e19cdff9b62760e6c10ba766a055eaf">isTensorReshapeOpFoldableByLinearization</a> (TensorCollapseShapeOp collapseOp, <a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a> useIndexMap, bool asProducer)</td></tr>
<tr class="separator:a3e19cdff9b62760e6c10ba766a055eaf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9f2fdb5885c8b9f40134155acbb1370d"><td class="memTemplParams" colspan="2">template&lt;typename TensorReshapeOp &gt; </td></tr>
<tr class="memitem:a9f2fdb5885c8b9f40134155acbb1370d"><td class="memTemplItemLeft" align="right" valign="top">static bool&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="ElementwiseOpFusion_8cpp.html#a9f2fdb5885c8b9f40134155acbb1370d">isUnitDimExpansionOnly</a> (TensorReshapeOp reshapeOp)</td></tr>
<tr class="memdesc:a9f2fdb5885c8b9f40134155acbb1370d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if the reshape operation is only expansion into/collapsing of unit-dimension.  <a href="#a9f2fdb5885c8b9f40134155acbb1370d">More...</a><br /></td></tr>
<tr class="separator:a9f2fdb5885c8b9f40134155acbb1370d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9cdb52727e15a09bab2229fd0b4f9155"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ElementwiseOpFusion_8cpp.html#a9cdb52727e15a09bab2229fd0b4f9155">isFusableWithReshapeByDimExpansion</a> (GenericOp genericOp, <a class="el" href="classmlir_1_1OpOperand.html">OpOperand</a> *fusableOpOperand)</td></tr>
<tr class="memdesc:a9cdb52727e15a09bab2229fd0b4f9155"><td class="mdescLeft">&#160;</td><td class="mdescRight">Conditions for folding a generic operation with a reshape op by expanding the iteration space dimensionality for tensor operations.  <a href="#a9cdb52727e15a09bab2229fd0b4f9155">More...</a><br /></td></tr>
<tr class="separator:a9cdb52727e15a09bab2229fd0b4f9155"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa59f07e5f7196ab45994687cbfcab519"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structmlir_1_1LogicalResult.html">LogicalResult</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ElementwiseOpFusion_8cpp.html#aa59f07e5f7196ab45994687cbfcab519">isGenericOpExpandable</a> (GenericOp genericOp, const ExpansionInfo &amp;expansionInfo, <a class="el" href="classmlir_1_1PatternRewriter.html">PatternRewriter</a> &amp;rewriter)</td></tr>
<tr class="memdesc:aa59f07e5f7196ab45994687cbfcab519"><td class="mdescLeft">&#160;</td><td class="mdescRight">Epanding the body of a linalg operation requires adaptations of the accessed loop indices.  <a href="#aa59f07e5f7196ab45994687cbfcab519">More...</a><br /></td></tr>
<tr class="separator:aa59f07e5f7196ab45994687cbfcab519"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aff1bcc53176a04b539b16e59cbac323e"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ElementwiseOpFusion_8cpp.html#aff1bcc53176a04b539b16e59cbac323e">getIndexingMapInExpandedOp</a> (<a class="el" href="classmlir_1_1OpBuilder.html">OpBuilder</a> &amp;builder, <a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a> indexingMap, const ExpansionInfo &amp;expansionInfo)</td></tr>
<tr class="memdesc:aff1bcc53176a04b539b16e59cbac323e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the indexing map to use in the expanded op for a given the <code>indexingMap</code> of the original operation.  <a href="#aff1bcc53176a04b539b16e59cbac323e">More...</a><br /></td></tr>
<tr class="separator:aff1bcc53176a04b539b16e59cbac323e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af9ac3c8d820ffb7c2bde775b389c040c"><td class="memItemLeft" align="right" valign="top">static RankedTensorType&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ElementwiseOpFusion_8cpp.html#af9ac3c8d820ffb7c2bde775b389c040c">getExpandedType</a> (RankedTensorType originalType, <a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a> indexingMap, const ExpansionInfo &amp;expansionInfo)</td></tr>
<tr class="memdesc:af9ac3c8d820ffb7c2bde775b389c040c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the type of the operand/result to use in the expanded op given the type in the original op.  <a href="#af9ac3c8d820ffb7c2bde775b389c040c">More...</a><br /></td></tr>
<tr class="separator:af9ac3c8d820ffb7c2bde775b389c040c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adaaf23f77744995b559eea5f6f3beec3"><td class="memItemLeft" align="right" valign="top">static SmallVector&lt; <a class="el" href="namespacemlir.html#ab973fb931221b9539fe0ffd408e261ff">ReassociationIndices</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ElementwiseOpFusion_8cpp.html#adaaf23f77744995b559eea5f6f3beec3">getReassociationForExpansion</a> (<a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a> indexingMap, const ExpansionInfo &amp;expansionInfo)</td></tr>
<tr class="memdesc:adaaf23f77744995b559eea5f6f3beec3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the reassociation maps to use in the <code>linalg.tensor_expand_shape</code> operation to convert the operands of the original operation to operands of the expanded operation.  <a href="#adaaf23f77744995b559eea5f6f3beec3">More...</a><br /></td></tr>
<tr class="separator:adaaf23f77744995b559eea5f6f3beec3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a500dd0360de9862e17d177987cb5a3f5"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classvoid.html">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ElementwiseOpFusion_8cpp.html#a500dd0360de9862e17d177987cb5a3f5">updateExpandedGenericOpRegion</a> (<a class="el" href="classmlir_1_1PatternRewriter.html">PatternRewriter</a> &amp;rewriter, <a class="el" href="classmlir_1_1Location.html">Location</a> loc, <a class="el" href="classmlir_1_1Region.html">Region</a> &amp;fusedRegion, const ExpansionInfo &amp;expansionInfo)</td></tr>
<tr class="memdesc:a500dd0360de9862e17d177987cb5a3f5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Update the body of an expanded linalg operation having index semantics.  <a href="#a500dd0360de9862e17d177987cb5a3f5">More...</a><br /></td></tr>
<tr class="separator:a500dd0360de9862e17d177987cb5a3f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a335d26611c359c111e9ea2b0fd4520aa"><td class="memItemLeft" align="right" valign="top">static Optional&lt; SmallVector&lt; <a class="el" href="classmlir_1_1Value.html">Value</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ElementwiseOpFusion_8cpp.html#a335d26611c359c111e9ea2b0fd4520aa">fuseWithReshapeByExpansion</a> (GenericOp genericOp, <a class="el" href="classmlir_1_1Operation.html">Operation</a> *reshapeOp, <a class="el" href="classmlir_1_1OpOperand.html">OpOperand</a> *fusableOpOperand, <a class="el" href="classmlir_1_1PatternRewriter.html">PatternRewriter</a> &amp;rewriter)</td></tr>
<tr class="memdesc:a335d26611c359c111e9ea2b0fd4520aa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Implements the fusion of a tensor_collapse_shape or a tensor_expand_shape op and a generic op as explained in <code>isFusableWithReshapeByExpansion</code>.  <a href="#a335d26611c359c111e9ea2b0fd4520aa">More...</a><br /></td></tr>
<tr class="separator:a335d26611c359c111e9ea2b0fd4520aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a157c90db51674160d24a3986755ac292"><td class="memItemLeft" align="right" valign="top">static Optional&lt; SmallVector&lt; <a class="el" href="classmlir_1_1Value.html">Value</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ElementwiseOpFusion_8cpp.html#a157c90db51674160d24a3986755ac292">fuseElementwiseOps</a> (<a class="el" href="classmlir_1_1PatternRewriter.html">PatternRewriter</a> &amp;rewriter, <a class="el" href="classmlir_1_1OpOperand.html">OpOperand</a> *consumerOpOperand, GenericOp producer, const <a class="el" href="namespacemlir_1_1linalg.html#a7f0c7d5683991009cfddd7748b7f8d4d">ControlElementwiseOpsFusionFn</a> &amp;controlFn)</td></tr>
<tr class="separator:a157c90db51674160d24a3986755ac292"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="ad5db310021e942e1aebc58774be61a65"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad5db310021e942e1aebc58774be61a65">&#9670;&nbsp;</a></span>areElementwiseOpsFusable()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool areElementwiseOpsFusable </td>
          <td>(</td>
          <td class="paramtype">GenericOp&#160;</td>
          <td class="paramname"><em>producer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GenericOp&#160;</td>
          <td class="paramname"><em>consumer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmlir_1_1OpOperand.html">OpOperand</a> *&#160;</td>
          <td class="paramname"><em>consumerOpOperand</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Conditions for elementwise fusion of generic operations. </p>

<p class="definition">Definition at line <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l00062">62</a> of file <a class="el" href="ElementwiseOpFusion_8cpp_source.html">ElementwiseOpFusion.cpp</a>.</p>

<p class="reference">References <a class="el" href="UseDefLists_8h_source.html#l00133">mlir::IROperand&lt; DerivedT, IRValueT &gt;::get()</a>, <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l00032">getIndexingMapOfProducerOperandsInCoordinatesOfFusedOp()</a>, <a class="el" href="IR_2AffineMap_8cpp_source.html#l00302">mlir::AffineMap::getNumResults()</a>, and <a class="el" href="IR_2AffineMap_8cpp_source.html#l00513">mlir::AffineMap::isPermutation()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l00244">fuseElementwiseOpsImpl()</a>.</p>

</div>
</div>
<a id="a157c90db51674160d24a3986755ac292"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a157c90db51674160d24a3986755ac292">&#9670;&nbsp;</a></span>fuseElementwiseOps()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static Optional&lt;SmallVector&lt;<a class="el" href="classmlir_1_1Value.html">Value</a>&gt; &gt; fuseElementwiseOps </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classmlir_1_1PatternRewriter.html">PatternRewriter</a> &amp;&#160;</td>
          <td class="paramname"><em>rewriter</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmlir_1_1OpOperand.html">OpOperand</a> *&#160;</td>
          <td class="paramname"><em>consumerOpOperand</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GenericOp&#160;</td>
          <td class="paramname"><em>producer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespacemlir_1_1linalg.html#a7f0c7d5683991009cfddd7748b7f8d4d">ControlElementwiseOpsFusionFn</a> &amp;&#160;</td>
          <td class="paramname"><em>controlFn</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l01596">1596</a> of file <a class="el" href="ElementwiseOpFusion_8cpp_source.html">ElementwiseOpFusion.cpp</a>.</p>

<p class="reference">References <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l00244">fuseElementwiseOpsImpl()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l01606">mlir::linalg::skipUnitDimReshape()</a>.</p>

</div>
</div>
<a id="a0ad4a9eeb98d28aab625b54dbd390fea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0ad4a9eeb98d28aab625b54dbd390fea">&#9670;&nbsp;</a></span>fuseElementwiseOpsImpl()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static Optional&lt;SmallVector&lt;<a class="el" href="classmlir_1_1Value.html">Value</a>&gt; &gt; fuseElementwiseOpsImpl </td>
          <td>(</td>
          <td class="paramtype">GenericOp&#160;</td>
          <td class="paramname"><em>producer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmlir_1_1OpOperand.html">OpOperand</a> *&#160;</td>
          <td class="paramname"><em>consumerOpOperand</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespacemlir_1_1linalg.html#a7f0c7d5683991009cfddd7748b7f8d4d">ControlElementwiseOpsFusionFn</a> &amp;&#160;</td>
          <td class="paramname"><em>controlFn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmlir_1_1PatternRewriter.html">PatternRewriter</a> &amp;&#160;</td>
          <td class="paramname"><em>rewriter</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l00244">244</a> of file <a class="el" href="ElementwiseOpFusion_8cpp_source.html">ElementwiseOpFusion.cpp</a>.</p>

<p class="reference">References <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l00062">areElementwiseOpsFusable()</a>, <a class="el" href="IR_2AffineMap_8cpp_source.html#l00444">mlir::AffineMap::compose()</a>, <a class="el" href="Builders_8h_source.html#l00424">mlir::OpBuilder::create()</a>, <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l00133">generateFusedElementwiseOpRegion()</a>, <a class="el" href="Builders_8cpp_source.html#l00262">mlir::Builder::getAffineMapArrayAttr()</a>, <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l00032">getIndexingMapOfProducerOperandsInCoordinatesOfFusedOp()</a>, <a class="el" href="UseDefLists_8h_source.html#l00037">mlir::detail::IROperandBase::getOwner()</a>, and <a class="el" href="IR_2AffineMap_8cpp_source.html#l00673">mlir::inversePermutation()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l01596">fuseElementwiseOps()</a>.</p>

</div>
</div>
<a id="a335d26611c359c111e9ea2b0fd4520aa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a335d26611c359c111e9ea2b0fd4520aa">&#9670;&nbsp;</a></span>fuseWithReshapeByExpansion()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static Optional&lt;SmallVector&lt;<a class="el" href="classmlir_1_1Value.html">Value</a>&gt; &gt; fuseWithReshapeByExpansion </td>
          <td>(</td>
          <td class="paramtype">GenericOp&#160;</td>
          <td class="paramname"><em>genericOp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmlir_1_1Operation.html">Operation</a> *&#160;</td>
          <td class="paramname"><em>reshapeOp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmlir_1_1OpOperand.html">OpOperand</a> *&#160;</td>
          <td class="paramname"><em>fusableOpOperand</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmlir_1_1PatternRewriter.html">PatternRewriter</a> &amp;&#160;</td>
          <td class="paramname"><em>rewriter</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements the fusion of a tensor_collapse_shape or a tensor_expand_shape op and a generic op as explained in <code>isFusableWithReshapeByExpansion</code>. </p>
<p>Assumes that those conditions have been satisfied. </p>

<p class="definition">Definition at line <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l00719">719</a> of file <a class="el" href="ElementwiseOpFusion_8cpp_source.html">ElementwiseOpFusion.cpp</a>.</p>

<p class="reference">References <a class="el" href="IR_2Region_8h_source.html#l00055">mlir::Region::begin()</a>, <a class="el" href="Block_8h_source.html#l00135">mlir::Block::begin()</a>, <a class="el" href="Value_8h_source.html#l00109">mlir::Value::cast()</a>, <a class="el" href="PatternMatch_8cpp_source.html#l00350">mlir::RewriterBase::cloneRegionBefore()</a>, <a class="el" href="IR_2AffineMap_8cpp_source.html#l00718">mlir::concatAffineMaps()</a>, <a class="el" href="Builders_8h_source.html#l00424">mlir::OpBuilder::create()</a>, <a class="el" href="Attributes_8h_source.html#l00120">mlir::Attribute::dyn_cast()</a>, <a class="el" href="Matchers_8h_source.html#l00206">mlir::detail::enumerate()</a>, <a class="el" href="LogicalResult_8h_source.html#l00072">mlir::failed()</a>, <a class="el" href="LogicalResult_8h_source.html#l00062">mlir::failure()</a>, <a class="el" href="PatternMatch_8h_source.html#l00777">mlir::RewriterBase::finalizeRootUpdate()</a>, <a class="el" href="Block_8h_source.html#l00145">mlir::Block::front()</a>, <a class="el" href="MLIRContext_8cpp_source.html#l00932">mlir::AffineMap::get()</a>, <a class="el" href="IR_2BuiltinAttributes_8cpp_source.html#l00675">mlir::DenseElementsAttr::get()</a>, <a class="el" href="UseDefLists_8h_source.html#l00133">mlir::IROperand&lt; DerivedT, IRValueT &gt;::get()</a>, <a class="el" href="IR_2AffineExpr_8cpp_source.html#l00489">mlir::getAffineDimExpr()</a>, <a class="el" href="Builders_8cpp_source.html#l00262">mlir::Builder::getAffineMapArrayAttr()</a>, <a class="el" href="Block_8h_source.html#l00121">mlir::Block::getArgument()</a>, <a class="el" href="IR_2AffineMap_8cpp_source.html#l00320">mlir::AffineMap::getDimPosition()</a>, <a class="el" href="IR_2BuiltinTypes_8cpp_source.html#l00348">mlir::ShapedType::getElementType()</a>, <a class="el" href="SPIRVOps_8cpp_source.html#l00639">getElementType()</a>, <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l00638">getExpandedType()</a>, <a class="el" href="Builders_8cpp_source.html#l00032">mlir::Builder::getFusedLoc()</a>, <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l00620">getIndexingMapInExpandedOp()</a>, <a class="el" href="Operation_8h_source.html#l00106">mlir::Operation::getLoc()</a>, <a class="el" href="Value_8cpp_source.html#l00026">mlir::Value::getLoc()</a>, <a class="el" href="IR_2AffineMap_8cpp_source.html#l00302">mlir::AffineMap::getNumResults()</a>, <a class="el" href="StructuredOpsUtils_8h_source.html#l00080">mlir::getParallelIteratorTypeName()</a>, <a class="el" href="IR_2AffineExpr_8cpp_source.html#l00310">mlir::AffineDimExpr::getPosition()</a>, <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l00657">getReassociationForExpansion()</a>, <a class="el" href="IR_2AffineMap_8cpp_source.html#l00311">mlir::AffineMap::getResults()</a>, <a class="el" href="Traits_8cpp_source.html#l00117">getShape()</a>, <a class="el" href="IR_2BuiltinAttributes_8h_source.html#l00382">mlir::DenseElementsAttr::getSplatValue()</a>, <a class="el" href="Block_8cpp_source.html#l00257">mlir::Block::getTerminator()</a>, <a class="el" href="Attributes_8h_source.html#l00067">mlir::Attribute::getType()</a>, <a class="el" href="IR_2BuiltinAttributes_8cpp_source.html#l00997">mlir::DenseElementsAttr::getType()</a>, <a class="el" href="OperationSupport_8h_source.html#l01101">mlir::ValueRange::getTypes()</a>, <a class="el" href="PatternMatch_8cpp_source.html#l00338">mlir::RewriterBase::inlineRegionBefore()</a>, <a class="el" href="IR_2AffineMap_8cpp_source.html#l00673">mlir::inversePermutation()</a>, <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l00491">isFusableWithReshapeByDimExpansion()</a>, <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l00598">isGenericOpExpandable()</a>, <a class="el" href="Types_8cpp_source.html#l00087">mlir::Type::isIntOrFloat()</a>, <a class="el" href="IR_2BuiltinAttributes_8cpp_source.html#l00876">mlir::DenseElementsAttr::isSplat()</a>, <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l00402">isTensorReshapeOpFoldableByLinearization()</a>, <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l00421">isUnitDimExpansionOnly()</a>, <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l00359">linearizeCollapsedDims()</a>, <a class="el" href="Matchers_8h_source.html#l00231">mlir::m_Constant()</a>, <a class="el" href="BlockAndValueMapping_8h_source.html#l00030">mlir::BlockAndValueMapping::map()</a>, <a class="el" href="Matchers_8h_source.html#l00266">mlir::matchPattern()</a>, <a class="el" href="PatternMatch_8h_source.html#l00800">mlir::RewriterBase::notifyMatchFailure()</a>, <a class="el" href="PatternMatch_8cpp_source.html#l00244">mlir::RewriterBase::replaceOp()</a>, <a class="el" href="PatternMatch_8h_source.html#l00739">mlir::RewriterBase::replaceOpWithNewOp()</a>, <a class="el" href="PatternMatch_8h_source.html#l00772">mlir::RewriterBase::startRootUpdate()</a>, <a class="el" href="LogicalResult_8h_source.html#l00056">mlir::success()</a>, and <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l00677">updateExpandedGenericOpRegion()</a>.</p>

</div>
</div>
<a id="a42aab670a146bbd3928a9c54a9d18c3e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a42aab670a146bbd3928a9c54a9d18c3e">&#9670;&nbsp;</a></span>generateFusedElementwiseOpRegion()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="classvoid.html">void</a> generateFusedElementwiseOpRegion </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classmlir_1_1PatternRewriter.html">PatternRewriter</a> &amp;&#160;</td>
          <td class="paramname"><em>rewriter</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GenericOp&#160;</td>
          <td class="paramname"><em>fusedOp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a>&#160;</td>
          <td class="paramname"><em>consumerToProducerLoopsMap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmlir_1_1OpOperand.html">OpOperand</a> *&#160;</td>
          <td class="paramname"><em>consumerOpOperand</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classunsigned.html">unsigned</a>&#160;</td>
          <td class="paramname"><em>nloops</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Generate the region of the fused tensor operation. </p>
<p>The region of the fused op must be empty. </p>

<p class="definition">Definition at line <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l00133">133</a> of file <a class="el" href="ElementwiseOpFusion_8cpp_source.html">ElementwiseOpFusion.cpp</a>.</p>

<p class="reference">References <a class="el" href="Block_8cpp_source.html#l00141">mlir::Block::addArgument()</a>, <a class="el" href="Builders_8cpp_source.html#l00463">mlir::OpBuilder::clone()</a>, <a class="el" href="Builders_8h_source.html#l00424">mlir::OpBuilder::create()</a>, <a class="el" href="Value_8h_source.html#l00101">mlir::Value::dyn_cast()</a>, <a class="el" href="Block_8h_source.html#l00145">mlir::Block::front()</a>, <a class="el" href="UseDefLists_8h_source.html#l00133">mlir::IROperand&lt; DerivedT, IRValueT &gt;::get()</a>, <a class="el" href="Block_8h_source.html#l00121">mlir::Block::getArgument()</a>, <a class="el" href="Block_8h_source.html#l00076">mlir::Block::getArguments()</a>, <a class="el" href="Value_8cpp_source.html#l00020">mlir::Value::getDefiningOp()</a>, <a class="el" href="Block_8h_source.html#l00120">mlir::Block::getNumArguments()</a>, <a class="el" href="Value_8cpp_source.html#l00212">mlir::OpOperand::getOperandNumber()</a>, <a class="el" href="Block_8h_source.html#l00129">mlir::Block::getOperations()</a>, <a class="el" href="UseDefLists_8h_source.html#l00037">mlir::detail::IROperandBase::getOwner()</a>, <a class="el" href="IR_2AffineMap_8cpp_source.html#l00519">mlir::AffineMap::getSubMap()</a>, <a class="el" href="Value_8h_source.html#l00119">mlir::Value::getType()</a>, <a class="el" href="BlockAndValueMapping_8h_source.html#l00059">mlir::BlockAndValueMapping::lookupOrDefault()</a>, <a class="el" href="BlockAndValueMapping_8h_source.html#l00030">mlir::BlockAndValueMapping::map()</a>, <a class="el" href="PolynomialApproximation_8cpp_source.html#l00185">max()</a>, and <a class="el" href="Builders_8h_source.html#l00364">mlir::OpBuilder::setInsertionPointToStart()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l00244">fuseElementwiseOpsImpl()</a>.</p>

</div>
</div>
<a id="af9ac3c8d820ffb7c2bde775b389c040c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af9ac3c8d820ffb7c2bde775b389c040c">&#9670;&nbsp;</a></span>getExpandedType()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static RankedTensorType getExpandedType </td>
          <td>(</td>
          <td class="paramtype">RankedTensorType&#160;</td>
          <td class="paramname"><em>originalType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a>&#160;</td>
          <td class="paramname"><em>indexingMap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const ExpansionInfo &amp;&#160;</td>
          <td class="paramname"><em>expansionInfo</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Return the type of the operand/result to use in the expanded op given the type in the original op. </p>

<p class="definition">Definition at line <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l00638">638</a> of file <a class="el" href="ElementwiseOpFusion_8cpp_source.html">ElementwiseOpFusion.cpp</a>.</p>

<p class="reference">References <a class="el" href="IR_2AffineMap_8cpp_source.html#l00311">mlir::AffineMap::getResults()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l00719">fuseWithReshapeByExpansion()</a>.</p>

</div>
</div>
<a id="aff1bcc53176a04b539b16e59cbac323e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aff1bcc53176a04b539b16e59cbac323e">&#9670;&nbsp;</a></span>getIndexingMapInExpandedOp()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a> getIndexingMapInExpandedOp </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classmlir_1_1OpBuilder.html">OpBuilder</a> &amp;&#160;</td>
          <td class="paramname"><em>builder</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a>&#160;</td>
          <td class="paramname"><em>indexingMap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const ExpansionInfo &amp;&#160;</td>
          <td class="paramname"><em>expansionInfo</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Return the indexing map to use in the expanded op for a given the <code>indexingMap</code> of the original operation. </p>

<p class="definition">Definition at line <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l00620">620</a> of file <a class="el" href="ElementwiseOpFusion_8cpp_source.html">ElementwiseOpFusion.cpp</a>.</p>

<p class="reference">References <a class="el" href="MLIRContext_8cpp_source.html#l00932">mlir::AffineMap::get()</a>, <a class="el" href="Builders_8cpp_source.html#l00289">mlir::Builder::getAffineDimExpr()</a>, <a class="el" href="Builders_8h_source.html#l00054">mlir::Builder::getContext()</a>, <a class="el" href="IR_2AffineMap_8cpp_source.html#l00298">mlir::AffineMap::getNumSymbols()</a>, and <a class="el" href="IR_2AffineMap_8cpp_source.html#l00311">mlir::AffineMap::getResults()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l00719">fuseWithReshapeByExpansion()</a>.</p>

</div>
</div>
<a id="a19679bdb1cb388e2cf93c2dab27ffe52"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a19679bdb1cb388e2cf93c2dab27ffe52">&#9670;&nbsp;</a></span>getIndexingMapOfProducerOperandsInCoordinatesOfFusedOp()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a> getIndexingMapOfProducerOperandsInCoordinatesOfFusedOp </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classmlir_1_1OpOperand.html">OpOperand</a> *&#160;</td>
          <td class="paramname"><em>producerOpOperand</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a>&#160;</td>
          <td class="paramname"><em>producerResultIndexMap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a>&#160;</td>
          <td class="paramname"><em>fusedConsumerArgIndexMap</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Append to <code>fusedOpIndexingMapAttrs</code> the indexing maps for the operands of the <code>producer</code> to use in the fused operation given the indexing map of the result of the producer in the consumer. </p>

<p class="definition">Definition at line <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l00032">32</a> of file <a class="el" href="ElementwiseOpFusion_8cpp_source.html">ElementwiseOpFusion.cpp</a>.</p>

<p class="reference">References <a class="el" href="IR_2AffineMap_8cpp_source.html#l00444">mlir::AffineMap::compose()</a>, <a class="el" href="UseDefLists_8h_source.html#l00037">mlir::detail::IROperandBase::getOwner()</a>, and <a class="el" href="IR_2AffineMap_8cpp_source.html#l00673">mlir::inversePermutation()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l00062">areElementwiseOpsFusable()</a>, and <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l00244">fuseElementwiseOpsImpl()</a>.</p>

</div>
</div>
<a id="adaaf23f77744995b559eea5f6f3beec3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adaaf23f77744995b559eea5f6f3beec3">&#9670;&nbsp;</a></span>getReassociationForExpansion()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static SmallVector&lt;<a class="el" href="namespacemlir.html#ab973fb931221b9539fe0ffd408e261ff">ReassociationIndices</a>&gt; getReassociationForExpansion </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a>&#160;</td>
          <td class="paramname"><em>indexingMap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const ExpansionInfo &amp;&#160;</td>
          <td class="paramname"><em>expansionInfo</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns the reassociation maps to use in the <code>linalg.tensor_expand_shape</code> operation to convert the operands of the original operation to operands of the expanded operation. </p>
<p>The same method is used to compute the <code>linalg.tensor_collapse_shape</code> used to collapse the result of the expanded op to get the value that can replace all uses of the results of the original op. </p>

<p class="definition">Definition at line <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l00657">657</a> of file <a class="el" href="ElementwiseOpFusion_8cpp_source.html">ElementwiseOpFusion.cpp</a>.</p>

<p class="reference">References <a class="el" href="IR_2AffineMap_8cpp_source.html#l00311">mlir::AffineMap::getResults()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l00719">fuseWithReshapeByExpansion()</a>.</p>

</div>
</div>
<a id="a9cdb52727e15a09bab2229fd0b4f9155"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9cdb52727e15a09bab2229fd0b4f9155">&#9670;&nbsp;</a></span>isFusableWithReshapeByDimExpansion()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool isFusableWithReshapeByDimExpansion </td>
          <td>(</td>
          <td class="paramtype">GenericOp&#160;</td>
          <td class="paramname"><em>genericOp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmlir_1_1OpOperand.html">OpOperand</a> *&#160;</td>
          <td class="paramname"><em>fusableOpOperand</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Conditions for folding a generic operation with a reshape op by expanding the iteration space dimensionality for tensor operations. </p>
<p>These are preconditions assumed by <code>foldReshapeByDimExpansion</code> which implements the following fusion pattern.</p>
<p>Consider</p>
<p>c = linalg.generic ins(a, b : memref&lt;?x?x?xf32&gt;, memref&lt;?x?xf32&gt;) indexing_maps = [affine_map&lt;(d0, d1, d2) -&gt; (d1, d0, d2)&gt;, affine_map&lt;(d0, d1, d2) -&gt; (d1, d2)&gt;, affine_map&lt;(d0, d1, d2) -&gt; (d0, d2, d1)&gt;] d = linalg.tensor_expand_shape c [[0, 1], [2], [3, 4, 5]] : tensor&lt;?x?x?xf32&gt; into tensor&lt;?x?x?x?x?x?xf32&gt;</p>
<p>The reshape can be folded into the <code>genericOp</code> if its loop dimensionality is increased to match the result (operand) of the tensor_expand_shape. The indexing_map of the fused tensor in the <code>genericOp</code> and the reassociation map helps compute the indexing maps of the modified op. For the above example, based on the reassociation map it can be concluded that</p>
<ul>
<li>The loop used to access the first dimension of the fused tensor is split into two.</li>
<li>The loop used to access the second dimension of the fused tensor is kept as is.</li>
<li>The loop used to access the third dimension of the fused tensor is split into three.</li>
</ul>
<p>i.e. (e0, e1, e2, e3, e4) is the domain of the indexing map of the modified op, then</p>
<p>d0 -&gt; e0, e1 d1 -&gt; e2, e3, e4 d2 -&gt; e5</p>
<p>substituting this, the generic op can be rewritten as</p>
<p>d = linalg.generic ins(%0, %1 : ) indexing_maps = [affine_map&lt;(e0, e1, e2, e3, e4, e5) -&gt; (e2, e3, e4, e0, e1, e5)&gt;, affine_map&lt;(e0, e1, e2, e3, e4, e5) -&gt; (e2, e3, e4, e5)&gt;, affine_map&lt;(e0, e1, e2, e3, e4, e5) -&gt; (e0, e1, e5, e2, e3, e4)&gt;]</p>
<p>Since operands to the linalg generic are now 5D, reshapes can be introduced to make it consistent</p>
<p>%0 = linalg.tensor_expand_shape a [[0, 1, 2], [3, 4], [5]] : tensor&lt;?x?x?xf32&gt; into tensor&lt;?x?x?x?x?x?xf32&gt; %1 = linalg.tensor_expand_shape b [[0, 1, 2], [3]] : tensor&lt;?x?x?xf32&gt; into tensor&lt;?x?x?x?xf32&gt;</p>
<p>The added reshapes are again expanding patterns, so they will get fused with its producers if possible. </p>

<p class="definition">Definition at line <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l00491">491</a> of file <a class="el" href="ElementwiseOpFusion_8cpp_source.html">ElementwiseOpFusion.cpp</a>.</p>

<p class="reference">References <a class="el" href="Matchers_8h_source.html#l00206">mlir::detail::enumerate()</a>, <a class="el" href="LogicalResult_8h_source.html#l00062">mlir::failure()</a>, <a class="el" href="IR_2AffineMap_8cpp_source.html#l00320">mlir::AffineMap::getDimPosition()</a>, <a class="el" href="IR_2AffineMap_8cpp_source.html#l00294">mlir::AffineMap::getNumDims()</a>, <a class="el" href="IR_2AffineMap_8cpp_source.html#l00302">mlir::AffineMap::getNumResults()</a>, <a class="el" href="StructuredOpsUtils_8h_source.html#l00080">mlir::getParallelIteratorTypeName()</a>, <a class="el" href="IR_2AffineMap_8cpp_source.html#l00311">mlir::AffineMap::getResults()</a>, <a class="el" href="PatternMatch_8h_source.html#l00800">mlir::RewriterBase::notifyMatchFailure()</a>, and <a class="el" href="LogicalResult_8h_source.html#l00056">mlir::success()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l00719">fuseWithReshapeByExpansion()</a>.</p>

</div>
</div>
<a id="aa59f07e5f7196ab45994687cbfcab519"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa59f07e5f7196ab45994687cbfcab519">&#9670;&nbsp;</a></span>isGenericOpExpandable()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structmlir_1_1LogicalResult.html">LogicalResult</a> isGenericOpExpandable </td>
          <td>(</td>
          <td class="paramtype">GenericOp&#160;</td>
          <td class="paramname"><em>genericOp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const ExpansionInfo &amp;&#160;</td>
          <td class="paramname"><em>expansionInfo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmlir_1_1PatternRewriter.html">PatternRewriter</a> &amp;&#160;</td>
          <td class="paramname"><em>rewriter</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Epanding the body of a linalg operation requires adaptations of the accessed loop indices. </p>
<p>Specifically, access of indices in the original operation need to be replaced with linearizations of indices in the expanded op. That requires the shape of the expanded dimensions to be static (at least all but the most significant). For now check that these are all statically sized. Note that this could be extended to handle dynamic case, but the implementation below uses <code>affine.apply</code> which seems to have issues when the shapes are not static. </p>

<p class="definition">Definition at line <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l00598">598</a> of file <a class="el" href="ElementwiseOpFusion_8cpp_source.html">ElementwiseOpFusion.cpp</a>.</p>

<p class="reference">References <a class="el" href="IR_2BuiltinTypes_8h_source.html#l00138">mlir::ShapedType::isDynamic()</a>, <a class="el" href="PatternMatch_8h_source.html#l00800">mlir::RewriterBase::notifyMatchFailure()</a>, and <a class="el" href="LogicalResult_8h_source.html#l00056">mlir::success()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l00719">fuseWithReshapeByExpansion()</a>.</p>

</div>
</div>
<a id="a6ce95957ed38439fd53d3d27e52d94bc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6ce95957ed38439fd53d3d27e52d94bc">&#9670;&nbsp;</a></span>isTensorReshapeOpFoldableByLinearization() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool isTensorReshapeOpFoldableByLinearization </td>
          <td>(</td>
          <td class="paramtype">TensorExpandShapeOp&#160;</td>
          <td class="paramname"><em>expandOp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a>&#160;</td>
          <td class="paramname"><em>useIndexMap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>asProducer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l00402">402</a> of file <a class="el" href="ElementwiseOpFusion_8cpp_source.html">ElementwiseOpFusion.cpp</a>.</p>

<p class="reference">References <a class="el" href="IR_2AffineMap_8cpp_source.html#l00513">mlir::AffineMap::isPermutation()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l00719">fuseWithReshapeByExpansion()</a>.</p>

</div>
</div>
<a id="a3e19cdff9b62760e6c10ba766a055eaf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3e19cdff9b62760e6c10ba766a055eaf">&#9670;&nbsp;</a></span>isTensorReshapeOpFoldableByLinearization() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool isTensorReshapeOpFoldableByLinearization </td>
          <td>(</td>
          <td class="paramtype">TensorCollapseShapeOp&#160;</td>
          <td class="paramname"><em>collapseOp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a>&#160;</td>
          <td class="paramname"><em>useIndexMap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>asProducer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l00411">411</a> of file <a class="el" href="ElementwiseOpFusion_8cpp_source.html">ElementwiseOpFusion.cpp</a>.</p>

<p class="reference">References <a class="el" href="IR_2AffineMap_8cpp_source.html#l00513">mlir::AffineMap::isPermutation()</a>.</p>

</div>
</div>
<a id="a9f2fdb5885c8b9f40134155acbb1370d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9f2fdb5885c8b9f40134155acbb1370d">&#9670;&nbsp;</a></span>isUnitDimExpansionOnly()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename TensorReshapeOp &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool isUnitDimExpansionOnly </td>
          <td>(</td>
          <td class="paramtype">TensorReshapeOp&#160;</td>
          <td class="paramname"><em>reshapeOp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Check if the reshape operation is only expansion into/collapsing of unit-dimension. </p>

<p class="definition">Definition at line <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l00421">421</a> of file <a class="el" href="ElementwiseOpFusion_8cpp_source.html">ElementwiseOpFusion.cpp</a>.</p>

<p class="reference">References <a class="el" href="InterfaceSupport_8h_source.html#l00161">value</a>.</p>

<p class="reference">Referenced by <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l00719">fuseWithReshapeByExpansion()</a>, and <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l01606">mlir::linalg::skipUnitDimReshape()</a>.</p>

</div>
</div>
<a id="af364bc35560a153d63a9825064858f4b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af364bc35560a153d63a9825064858f4b">&#9670;&nbsp;</a></span>linearizeCollapsedDims()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename TensorReshapeOp &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a> linearizeCollapsedDims </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a>&#160;</td>
          <td class="paramname"><em>sourceMap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">TensorReshapeOp&#160;</td>
          <td class="paramname"><em>reshapeOp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Linearize the expressions in <code>sourceMap</code> based on the <code>reassociationMaps</code> provided, given the shape of the source tensor that corresponds to the <code>sourceMap</code>. </p>
<p>Note that this implicitly assumes that the tensors dimensions are "row-major" ordered logically.</p>
<p>For example:</p>
<p>%0 = op ... : tensor&lt;?x?x4x5xf32&gt; with output index_map <code>affine_map&lt;(d0, d1, d2, d3) -&gt; (d0, d1, d2, d3)&gt;</code></p>
<p>and reshape: %1 = linalg.tensor_collapse_shape %0 [[0], [0, 1, 2]] : tensor&lt;?x?x4x5xf32&gt; into tensor&lt;?x?xf32&gt;</p>
<p>would be rewritten into: %0 = op ... : tensor&lt;?x?x4x5xf32&gt; with output index_map <code>affine_map&lt;(d0, d1, d2, d3) -&gt; (d0, d1 * 20 + d2 * 5 + d3)&gt;</code> </p>

<p class="definition">Definition at line <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l00359">359</a> of file <a class="el" href="ElementwiseOpFusion_8cpp_source.html">ElementwiseOpFusion.cpp</a>.</p>

<p class="reference">References <a class="el" href="MLIRContext_8cpp_source.html#l00932">mlir::AffineMap::get()</a>, <a class="el" href="IR_2AffineMap_8cpp_source.html#l00253">mlir::AffineMap::getContext()</a>, <a class="el" href="IR_2AffineMap_8cpp_source.html#l00294">mlir::AffineMap::getNumDims()</a>, <a class="el" href="IR_2AffineMap_8cpp_source.html#l00298">mlir::AffineMap::getNumSymbols()</a>, <a class="el" href="IR_2AffineMap_8cpp_source.html#l00311">mlir::AffineMap::getResults()</a>, <a class="el" href="IR_2BuiltinTypes_8cpp_source.html#l01098">mlir::makeCanonicalStridedLayoutExpr()</a>, <a class="el" href="PolynomialApproximation_8cpp_source.html#l00185">max()</a>, and <a class="el" href="InterfaceSupport_8h_source.html#l00161">value</a>.</p>

<p class="reference">Referenced by <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l00719">fuseWithReshapeByExpansion()</a>.</p>

</div>
</div>
<a id="a500dd0360de9862e17d177987cb5a3f5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a500dd0360de9862e17d177987cb5a3f5">&#9670;&nbsp;</a></span>updateExpandedGenericOpRegion()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="classvoid.html">void</a> updateExpandedGenericOpRegion </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classmlir_1_1PatternRewriter.html">PatternRewriter</a> &amp;&#160;</td>
          <td class="paramname"><em>rewriter</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmlir_1_1Location.html">Location</a>&#160;</td>
          <td class="paramname"><em>loc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmlir_1_1Region.html">Region</a> &amp;&#160;</td>
          <td class="paramname"><em>fusedRegion</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const ExpansionInfo &amp;&#160;</td>
          <td class="paramname"><em>expansionInfo</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Update the body of an expanded linalg operation having index semantics. </p>
<p>The indices of the original operation need to be recovered by linearizing the indices of the correspoding dimensions of the expanded operation. For now it is assumed that the shapes of the expanded operation needed for linearization are static. </p>

<p class="definition">Definition at line <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l00677">677</a> of file <a class="el" href="ElementwiseOpFusion_8cpp_source.html">ElementwiseOpFusion.cpp</a>.</p>

<p class="reference">References <a class="el" href="IR_2AffineExpr_8h_source.html#l00328">mlir::bindDims()</a>, <a class="el" href="Builders_8h_source.html#l00424">mlir::OpBuilder::create()</a>, <a class="el" href="IR_2Region_8h_source.html#l00065">mlir::Region::front()</a>, <a class="el" href="Builders_8h_source.html#l00054">mlir::Builder::getContext()</a>, <a class="el" href="Block_8h_source.html#l00185">mlir::Block::getOps()</a>, <a class="el" href="IR_2BuiltinTypes_8h_source.html#l00138">mlir::ShapedType::isDynamic()</a>, <a class="el" href="PatternMatch_8cpp_source.html#l00244">mlir::RewriterBase::replaceOp()</a>, and <a class="el" href="Builders_8h_source.html#l00345">mlir::OpBuilder::setInsertionPointAfter()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ElementwiseOpFusion_8cpp_source.html#l00719">fuseWithReshapeByExpansion()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Dec 6 2021 20:34:09 for MLIR by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
